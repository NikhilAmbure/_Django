<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pizza-order</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">

{% block start %}
<div class="container mx-auto mt-20 px-4 max-w-xl">
    <h3 class="text-2xl font-semibold mb-2">Order ID - {{ order.order_id }}</h3>
    <p class="text-lg text-gray-700 mb-4">Amount - ${{ order.amount }}</p>

    <span id="status" class="inline-block px-3 py-1 rounded-full text-white bg-blue-600 text-sm">
        {{ order.status }}
    </span>

    <div class="progress-bar w-full bg-gray-200 rounded-full h-4 mt-6">
        <div class="bg-blue-600 h-4 rounded-full animate-pulse" style="width: 20%"></div>
    </div>
</div>
{% endblock %}


<script>

   var order_id = '{{ order.order_id }}';
  //  websocket connection
  let socket = new WebSocket(`ws://localhost:8000/ws/pizza/${order_id}/`);

  // onopen -> connection established
  socket.onopen = function(e){
    console.log("Connection established");
  }

  // Receiving   data from backend
  socket.onmessage = function(e){
    var data = JSON.parse(e.data)
    var value = data.payload.progress_percentage
    var status = data.payload.status

    // Now use above values to update the UI

    changeUI(value, status);
  }

  function changeUI(value, status){
    var progress = document.querySelector('.progress-bar > div')
    var status_html = document.querySelector('#status')

    // Changing progress bar at 100%
    if (value === 100){
      progress.classList.remove('bg-blue-600');
      progress.classList.add('bg-green-400');
    }

    status_html.innerHTML = status
    progress.style.width = value + "%" 
  }

</script>


</body>
</html>